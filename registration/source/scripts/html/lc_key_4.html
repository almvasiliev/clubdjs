<?php
//ДРУГИЕ ЗАВЕДЕНИЯ
$result_lc_key_4 = mysql_query("SELECT other_pages.p_id, page.p_id, page.p_name_priority, page.p_url, page.p_ar, city.city_name, page_parent.pp_name_short FROM other_pages, page, city, page_parent WHERE other_pages.p_id='$page_id' AND other_pages.op_show='1' AND page.city_id='$city_id' AND other_pages.op_pages_id=page.p_id AND (page.pp_id='1' OR page.pp_id='2' OR page.pp_id='3' OR page.pp_id='4' OR page.pp_id='5' OR page.pp_id='6') AND city.city_id='$city_id' AND page_parent.pp_id=page.pp_id ORDER by other_pages.op_sort LIMIT $array_lim_lc[$i]");

$array_id_p_4 = array();
$array_name_priority_p_4 = array();
$array_url_p_4 = array();
$array_ar_p_4 = array();
$array_name_short_pp_4 = array();
	while($myrow_lc_key_4 = mysql_fetch_array($result_lc_key_4))
        		{
            		$array_id_p_4[] = $myrow_lc_key_4['p_id'];
                    $array_name_priority_p_4[] = $myrow_lc_key_4['p_name_priority'];
                    $array_url_p_4[] = $myrow_lc_key_4['p_url'];
                    $array_ar_p_4[] = $myrow_lc_key_4['p_ar'];
                    $array_name_short_pp_4[] = $myrow_lc_key_4['pp_name_short'];
                    $city_name = $myrow_lc_key_4['city_name'];
				}
	
    if (isset($array_id_p_2) and !empty($array_id_p_2))
    	{
        	$array_id_p_4 = array_diff($array_id_p_4, $array_id_p_2);//В массиве $array_id_p_4 (Другие заведения) оставляем только те id, которые не присутствуют в массиве $array_id_p_2 (Рекомендуем посетить). Другими словами выбираем оставшиеся заведения.
        }
    if (isset($array_id_p_3) and !empty($array_id_p_3))
    	{
        	$array_id_p_4 = array_diff($array_id_p_4, $array_id_p_3);//В массиве $array_id_p_4 (Другие заведения) оставляем только те id, которые не присутствуют в массиве $array_id_p_3 (Популярные заведения). Другими словами выбираем оставшиеся заведения.
        }
        
    $keys_array_id_p_4 = array_keys($array_id_p_4);//Определяем индексы (ключи) выбранных заведений.
	       
    $carray_lc_4 = count($array_id_p_4);
			
            if ($carray_lc_4 > '0')
            	{
                	echo("
						<table cellpadding='0' cellspacing='0' width='160' height='40'>
						<tr>
						<td width='3' height='15' background='".define_host()."source/imgs/point_corner_up.gif'></td>
						<td width='154' height='15' background='".define_host()."source/imgs/point_up.gif'><p align=center><font class='title_popular_place'>&nbsp;&nbsp;Другие заведения&nbsp;&nbsp;</font></p></td>
						<td width='3' height='15' background='".define_host()."source/imgs/point_corner_up.gif'></td>
						</tr>
						<tr>
						<td width='3' height='22' background='".define_host()."source/imgs/point.gif'></td>
						<td width='154' height='22' valign=top class='text_other_place' bgcolor='#fcfcfc'><p align='left'><font class='text_popular_place'>Те ночные клубы, бары и рестораны, которые зачастую ищут посетители нашего сайта:</font></p>
                        ");                   
                    
                    for ($j = 0; $j <= $carray_lc_4-1; $j++)
            			{
							$x = $keys_array_id_p_4[$j];//Определяем ключ нужного заведения.
                            $string = $array_name_short_pp_4[$x]." ".$array_name_priority_p_4[$x]." (".$city_name.")";
                            $move_min = round((5-$array_ar_p_4[$x])/5*51);
                            $array_ar_p_4[$x] = round($array_ar_p_4[$x],1);
                            echo("<div style='float: left; width:100%;'><a href='".define_host()."".$array_url_p_4[$x]."/index.html' class='link_popular_place'>".$string."</a><br>
                            <div class='rating_min'><div class='bg_rating' style='background-position: -".$move_min."px 0;'><p class='stars' title='");if ($array_ar_p_4[$x] == '0'){echo("Без оценки'");}else{echo("Средний рейтинг: ".$array_ar_p_4[$x]."&nbsp;из&nbsp;5'");}echo("></p></div></div></div>
                            ");
						} 
					echo("
                    	</td>
						<td width='3' height='22' background='".define_host()."source/imgs/point.gif'></td>
						</tr>
						<tr>
						<td width='3' height='3' background='".define_host()."source/imgs/point.gif'></td>
						<td width='154' height='3' background='".define_host()."source/imgs/point.gif'></td>
						<td width='3' height='3' background='".define_host()."source/imgs/point.gif'></td>
						</tr>
						</table>
						
						<table cellpadding='0' cellspacing='0' width='160' height='15'>
						<tr>
						<td width='160' height='15'></td>
						</tr>
						</table>
                        ");
				}
?>